{% extends 'base.html' %}

{% block title %}Rules - TGB{% endblock %}

{% block content %}
  <div class="container py-4">
    <h1 class="mb-4">Define Message Processing Rules</h1>
    <form id="rulesForm">
      <div class="row mb-3">
        <label for="ruleName" class="col-sm-2 col-form-label">Rule Name:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="ruleName" name="ruleName" required>
        </div>
      </div>
      <div class="row mb-3">
        <label for="sourceChannel" class="col-sm-2 col-form-label">Source Channel:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="sourceChannel" name="sourceChannel" required>
        </div>
      </div>
      <div class="row mb-3">
        <label for="destinationChannel" class="col-sm-2 col-form-label">Destination Channel:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="destinationChannel" name="destinationChannel" required>
        </div>
      </div>
      <div class="row mb-3">
        <label for="modificationType" class="col-sm-2 col-form-label">Modification Type:</label>
        <div class="col-sm-10">
          <select class="form-select" id="modificationType" name="modificationType" required>
            <option value="uppercase">Uppercase</option>
            <option value="lowercase">Lowercase</option>
            <option value="reverse">Reverse</option>
            <!-- Add other modification types here -->
          </select>
        </div>
      </div>
      <div class="row mb-3">
        <label for="applyButton" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
          <button type="submit" class="btn btn-primary">Apply Rule</button>
        </div>
      </div>
    </form>
  </div>
{% endblock %}

{% block script %}
  <script>
    document.getElementById('rulesForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const ruleName = document.getElementById('ruleName').value;
      const sourceChannel = document.getElementById('sourceChannel').value;
      const destinationChannel = document.getElementById('destinationChannel').value;
      const modificationType = document.getElementById('modificationType').value;

      // Send the rule data to the backend using an API endpoint (you need to implement this in Flask)
      fetch('/api/add_rule', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          ruleName: ruleName,
          sourceChannel: sourceChannel,
          destinationChannel: destinationChannel,
          modificationType: modificationType,
        }),
      })
      .then(response => response.json())
      .then(data => {
        // Handle the response from the backend (e.g., show success message, display errors, etc.)
        console.log(data);
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });
  </script>
{% endblock %}
